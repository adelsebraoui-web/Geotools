<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GEOMETRI SYSTEM</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { background:#000; color:#0f0; font-family:'Courier New', monospace; height:100vh; overflow:hidden; }

/* LOGIN */
#ls { position:fixed; inset:0; z-index:999; display:flex; justify-content:center; align-items:center; background:#000; flex-direction:column; }
.lc { background:rgba(0,15,0,0.95); border:1px solid #0f0; padding:40px; text-align:center; min-width:350px; box-shadow:0 0 40px rgba(0,255,0,0.2); }
input { width:100%; padding:12px; background:#000; border:1px solid #0f0; color:#0f0; margin:20px 0; text-align:center; outline:none; }
.lb { width:100%; padding:12px; background:#0f0; color:#000; border:none; font-weight:bold; cursor:pointer; letter-spacing:2px; }

/* MENU GRID */
#app { display:none; height:100vh; flex-direction:column; background:#050505; font-family:'Inter', sans-serif; }
.header { padding:30px; border-bottom:1px solid #1a1a1a; text-align:center; }
.grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:25px; padding:40px; overflow-y:auto; }
.card { background:#111; border:1px solid #222; border-radius:15px; padding:40px; cursor:pointer; transition:0.3s; text-align:center; }
.card:hover { border-color:#0f0; transform:translateY(-5px); box-shadow:0 10px 30px rgba(0,255,0,0.1); }
.card h2 { color:#fff; font-size:18px; letter-spacing:1px; text-transform:uppercase; }

/* VIEW MODE */
#view { display:none; height:100vh; flex-direction:column; }
.toolbar { background:#000; border-bottom:1px solid #0f0; padding:10px 20px; display:flex; align-items:center; }
.back { background:transparent; border:1px solid #0f0; color:#0f0; padding:8px 15px; cursor:pointer; font-size:12px; }
iframe { flex:1; border:none; background:#fff; }
</style>
</head>
<body>
<div id="ls">
    <h1 style="letter-spacing:10px; margin-bottom:20px;">GEOMETRI</h1>
    <div class="lc">
        <p style="font-size:10px; opacity:0.6;">AUTHENTICATION REQUIRED</p>
        <input type="password" id="ps" placeholder="PASSCODE" onkeydown="if(event.key==='Enter')login()">
        <button class="lb" onclick="login()">ENTER SYSTEM</button>
    </div>
</div>

<div id="app">
    <div class="header"><h1 style="color:#fff; letter-spacing:5px;">GEOMETRI <span style="font-weight:300; opacity:0.5;">PORTAL</span></h1></div>
    <div class="grid" id="grid"></div>
</div>

<div id="view">
    <div class="toolbar"><button class="back" onclick="back()">← TILLBAKA TILL MENY</button></div>
    <div id="frame-wrap" style="flex:1; display:flex; flex-direction:column;"></div>
</div>

<script>
const DATA = [{"name":"Shims uträknare","content":"<!DOCTYPE html>\n<html lang=\"sv\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Geometri Analys Support</title>\n    \n    <!-- Externa bibliotek för UI och logik -->\n    <script crossorigin src=\"https://unpkg.com/react@18/umd/react.production.min.js\"><\/script>\n    <script crossorigin src=\"https://unpkg.com/react-dom@18/umd/react-dom.production.min.js\"><\/script>\n    <script src=\"https://unpkg.com/@babel/standalone/babel.min.js\"><\/script>\n    <script src=\"https://cdn.tailwindcss.com\"><\/script>\n    \n    <!-- Firebase SDK (förberedd för molnlagring) -->\n    <script type=\"module\">\n        import { initializeApp } from \"https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js\";\n        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp, query, orderBy } from \"https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js\";\n        import { getAuth, signInAnonymously } from \"https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js\";\n\n        // Klistra in din Firebase Config här för att spara i molnet\n        const firebaseConfig = {\n            apiKey: \"\",\n            authDomain: \"\",\n            projectId: \"\",\n            storageBucket: \"\",\n            messagingSenderId: \"\",\n            appId: \"\"\n        };\n\n        let db = null;\n        if (firebaseConfig.apiKey) {\n            try {\n                const app = initializeApp(firebaseConfig);\n                db = getFirestore(app);\n                const auth = getAuth(app);\n                signInAnonymously(auth);\n            } catch (e) {\n                console.error(\"Firebase misslyckades:\", e);\n            }\n        }\n\n        window.fs = { db, collection, addDoc, onSnapshot, deleteDoc, doc, serverTimestamp, query, orderBy };\n    <\/script>\n\n    <style>\n        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');\n        body { \n            font-family: 'Inter', sans-serif; \n            -webkit-tap-highlight-color: transparent;\n            touch-action: manipulation;\n        }\n        input[type=\"number\"] { font-size: 16px; } /* Förhindrar automatisk zoom på iPhone */\n        \n        .log-card {\n            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        .log-card:active {\n            transform: scale(0.98);\n        }\n    </style>\n</head>\n<body class=\"bg-slate-50 text-slate-900\">\n    <div id=\"root\"></div>\n\n    <script type=\"text/babel\">\n        const { useState, useEffect, useMemo } = React;\n\n        const Icons = {\n            Ruler: () => <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\" /></svg>,\n            Trash: () => <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" /></svg>,\n            Save: () => <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4\" /></svg>,\n            ChevronDown: () => <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\" /></svg>,\n            ChevronUp: () => <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M5 15l7-7 7 7\" /></svg>,\n            Download: () => <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" /></svg>\n        };\n\n        function App() {\n            const [logs, setLogs] = useState([]);\n            const [expandedIds, setExpandedIds] = useState(new Set());\n            const [machineId, setMachineId] = useState(\"\");\n            const [note, setNote] = useState(\"\");\n            const [before, setBefore] = useState({ x: \"\", y: \"\", z: \"\" });\n            const [after, setAfter] = useState({ x: \"\", y: \"\", z: \"\" });\n            const [isDemo, setIsDemo] = useState(true);\n\n            useEffect(() => {\n                const { db, collection, onSnapshot, query, orderBy } = window.fs;\n                if (db) {\n                    setIsDemo(false);\n                    const q = query(collection(db, \"shims_pro\"), orderBy(\"timestamp\", \"desc\"));\n                    return onSnapshot(q, (snapshot) => {\n                        setLogs(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));\n                    });\n                } else {\n                    const saved = localStorage.getItem(\"shims_storage_v1\");\n                    if (saved) setLogs(JSON.parse(saved));\n                }\n            }, []);\n\n            const delta = useMemo(() => {\n                const diff = (a, b) => {\n                    const res = (parseFloat(a || 0) - parseFloat(b || 0)).toFixed(2);\n                    return isNaN(res) ? \"0.00\" : res;\n                };\n                return { x: diff(after.x, before.x), y: diff(after.y, before.y), z: diff(after.z, before.z) };\n            }, [before, after]);\n\n            const saveEntry = async () => {\n                if (!machineId.trim()) return alert(\"Vänligen ange ett Maskin-ID.\");\n                \n                const entry = {\n                    machineId,\n                    before,\n                    after,\n                    delta,\n                    note,\n                    timestamp: new Date().toISOString()\n                };\n\n                const { db, collection, addDoc, serverTimestamp } = window.fs;\n                if (db) {\n                    await addDoc(collection(db, \"shims_pro\"), { ...entry, timestamp: serverTimestamp() });\n                } else {\n                    const newEntry = { ...entry, id: Date.now().toString() };\n                    const newLogs = [newEntry, ...logs];\n                    setLogs(newLogs);\n                    localStorage.setItem(\"shims_storage_v1\", JSON.stringify(newLogs));\n                }\n                \n                setMachineId(\"\"); setNote(\"\"); setBefore({x:\"\",y:\"\",z:\"\"}); setAfter({x:\"\",y:\"\",z:\"\"});\n            };\n\n            const removeLog = async (e, id, index) => {\n                e.stopPropagation(); // Hindra expandering vid radering\n                if (!confirm(\"Vill du radera denna mätning?\")) return;\n                const { db, doc, deleteDoc } = window.fs;\n                if (db && id) {\n                    await deleteDoc(doc(db, \"shims_pro\", id));\n                } else {\n                    const newLogs = logs.filter((l, i) => (l.id || i) !== (id || index));\n                    setLogs(newLogs);\n                    localStorage.setItem(\"shims_storage_v1\", JSON.stringify(newLogs));\n                }\n            };\n\n            const toggleExpand = (id) => {\n                const newExpanded = new Set(expandedIds);\n                if (newExpanded.has(id)) {\n                    newExpanded.delete(id);\n                } else {\n                    newExpanded.add(id);\n                }\n                setExpandedIds(newExpanded);\n            };\n\n            const exportToText = () => {\n                if (logs.length === 0) return alert(\"Det finns ingen data att exportera.\");\n                \n                let content = \"Shimslogg Geometri - Data\\n\";\n                content += \"==========================\\n\\n\";\n                \n                logs.forEach((log, index) => {\n                    const date = new Date(log.timestamp?.seconds ? log.timestamp.seconds * 1000 : log.timestamp).toLocaleString('sv-SE');\n                    content += `MÄTNING #${logs.length - index}\\n`;\n                    content += `Datum: ${date}\\n`;\n                    content += `Maskin-ID: ${log.machineId}\\n`;\n                    content += `--------------------------\\n`;\n                    content += `VÄRDEN (mm):\\n`;\n                    content += `X: Före: ${log.before.x || '0.00'} | Efter: ${log.after.x || '0.00'} | Diff: ${log.delta.x}\\n`;\n                    content += `Y: Före: ${log.before.y || '0.00'} | Efter: ${log.after.y || '0.00'} | Diff: ${log.delta.y}\\n`;\n                    content += `Z: Före: ${log.before.z || '0.00'} | Efter: ${log.after.z || '0.00'} | Diff: ${log.delta.z}\\n`;\n                    if (log.note) content += `Notering: ${log.note}\\n`;\n                    content += `\\n**************************\\n\\n`;\n                });\n\n                const blob = new Blob([content], { type: \"text/plain\" });\n                const url = URL.createObjectURL(blob);\n                const link = document.createElement(\"a\");\n                link.href = url;\n                link.download = `shimslogg_export_${new Date().toISOString().split('T')[0]}.txt`;\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n                URL.revokeObjectURL(url);\n            };\n\n            return (\n                <div className=\"max-w-md mx-auto min-h-screen p-4 pb-20\">\n                    <header className=\"flex items-center justify-between mb-8 pt-4\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"bg-blue-600 p-2.5 rounded-xl text-white shadow-lg shadow-blue-200\">\n                                <Icons.Ruler />\n                            </div>\n                            <div>\n                                <h1 className=\"font-bold text-xl tracking-tight\"> Geometri analys support</h1>\n                                <p className=\"text-[10px] text-slate-400 font-semibold uppercase tracking-widest\">Shims-uträknare</p>\n                            </div>\n                        </div>\n                        {isDemo && (\n                            <div className=\"flex flex-col items-end\">\n                                <span className=\"text-[10px] bg-amber-100 text-amber-700 font-bold px-2 py-1 rounded-full uppercase tracking-tighter\">Lokal Lagring</span>\n                            </div>\n                        )}\n                    </header>\n\n                    {/* Inmatningssektion */}\n                    <div className=\"bg-white rounded-3xl shadow-sm border border-slate-100 p-5 mb-8\">\n                        <div className=\"mb-5\">\n                            <label className=\"text-[11px] font-bold text-slate-400 uppercase ml-1 mb-1 block\">Identifiering</label>\n                            <input \n                                value={machineId} \n                                onChange={e => setMachineId(e.target.value)} \n                                placeholder=\"T.ex. Motor 04 / Pump B\" \n                                className=\"w-full p-4 bg-slate-50 rounded-2xl outline-none focus:ring-2 ring-blue-500/20 border border-transparent focus:border-blue-500/20 font-semibold transition-all\"\n                            />\n                        </div>\n\n                        <div className=\"grid grid-cols-2 gap-6 mb-6\">\n                            <div className=\"space-y-3\">\n                                <label className=\"text-[11px] font-bold text-slate-400 uppercase ml-1 block\">Före (mm)</label>\n                                {['x','y','z'].map(a => (\n                                    <div key={a} className=\"relative\">\n                                        <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-slate-300 uppercase\">{a}</span>\n                                        <input \n                                            type=\"number\" \n                                            step=\"0.01\"\n                                            value={before[a]} \n                                            onChange={e => setBefore({...before,[a]:e.target.value})} \n                                            className=\"w-full pl-7 p-3 bg-slate-50 rounded-xl text-sm border border-transparent focus:bg-white focus:border-slate-200 outline-none transition-all\" \n                                        />\n                                    </div>\n                                ))}\n                            </div>\n                            <div className=\"space-y-3\">\n                                <label className=\"text-[11px] font-bold text-blue-500 uppercase ml-1 block\">Efter (mm)</label>\n                                {['x','y','z'].map(a => (\n                                    <div key={a} className=\"relative\">\n                                        <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-[10px] font-bold text-blue-200 uppercase\">{a}</span>\n                                        <input \n                                            type=\"number\" \n                                            step=\"0.01\"\n                                            value={after[a]} \n                                            onChange={e => setAfter({...after, [a]:e.target.value})} \n                                            className=\"w-full pl-7 p-3 bg-blue-50/50 rounded-xl text-sm border border-transparent focus:bg-white focus:border-blue-100 outline-none transition-all text-blue-700 font-medium\" \n                                        />\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n\n                        <div className=\"flex items-center gap-3 pt-2 border-t border-slate-50\">\n                            <input \n                                value={note} \n                                onChange={e => setNote(e.target.value)} \n                                placeholder=\"Lägg till en notering...\" \n                                className=\"flex-1 p-2 text-sm outline-none bg-transparent placeholder:text-slate-300\" \n                            />\n                            <button \n                                onClick={saveEntry} \n                                className=\"bg-blue-600 text-white p-4 rounded-2xl hover:bg-blue-700 active:scale-90 shadow-lg shadow-blue-200 transition-all\"\n                            >\n                                <Icons.Save />\n                            </button>\n                        </div>\n                    </div>\n\n                    {/* Historiklista */}\n                    <div className=\"space-y-4\">\n                        <div className=\"flex items-center justify-between px-2\">\n                            <h2 className=\"text-xs font-bold text-slate-400 uppercase tracking-widest\">Senaste mätningar</h2>\n                            <button \n                                onClick={exportToText}\n                                className=\"flex items-center gap-1.5 text-[10px] font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100 transition-colors\"\n                            >\n                                <Icons.Download />\n                                EXPORTERA DATA\n                            </button>\n                        </div>\n                        \n                        {logs.length === 0 && (\n                            <div className=\"text-center py-12 bg-white rounded-3xl border border-dashed border-slate-200\">\n                                <p className=\"text-slate-400 text-sm italic\">Inga loggar sparade ännu.</p>\n                            </div>\n                        )}\n\n                        {logs.map((log, i) => {\n                            const id = log.id || i;\n                            const isExpanded = expandedIds.has(id);\n                            \n                            return (\n                                <div \n                                    key={id} \n                                    onClick={() => toggleExpand(id)}\n                                    className=\"log-card bg-white border border-slate-100 rounded-3xl p-5 shadow-sm relative cursor-pointer hover:border-blue-100 overflow-hidden animate-in fade-in slide-in-from-bottom-2\"\n                                >\n                                    <div className=\"flex justify-between items-start mb-4\">\n                                        <div className=\"flex-1\">\n                                            <div className=\"flex items-center gap-2\">\n                                                <h3 className=\"font-bold text-slate-800 text-base\">{log.machineId}</h3>\n                                                <div className=\"text-slate-300\">\n                                                    {isExpanded ? <Icons.ChevronUp /> : <Icons.ChevronDown />}\n                                                </div>\n                                            </div>\n                                            <p className=\"text-[10px] text-slate-400 font-medium uppercase mt-0.5\">\n                                                {new Date(log.timestamp?.seconds ? log.timestamp.seconds * 1000 : log.timestamp).toLocaleDateString('sv-SE', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' })}\n                                            </p>\n                                        </div>\n                                        <button \n                                            onClick={(e) => removeLog(e, log.id, i)} \n                                            className=\"p-2 text-slate-200 hover:text-rose-500 hover:bg-rose-50 rounded-lg transition-colors z-10\"\n                                        >\n                                            <Icons.Trash />\n                                        </button>\n                                    </div>\n\n                                    {/* Huvudvy: Delta (alltid synlig) */}\n                                    <div className=\"grid grid-cols-3 gap-3\">\n                                        {['x','y','z'].map(axis => (\n                                            <div key={axis} className=\"bg-slate-50/80 rounded-2xl p-3 text-center border border-slate-100/50\">\n                                                <span className=\"text-[9px] font-bold uppercase text-slate-400 block mb-1\">{axis} (Δ)</span>\n                                                <span className={`text-sm font-mono font-bold ${parseFloat(log.delta[axis]) > 0 ? 'text-emerald-600' : parseFloat(log.delta[axis]) < 0 ? 'text-rose-600' : 'text-slate-300'}`}>\n                                                    {parseFloat(log.delta[axis]) > 0 ? '+' : ''}{log.delta[axis]}\n                                                </span>\n                                            </div>\n                                        ))}\n                                    </div>\n\n                                    {/* Expanderad vy: Detaljer (Före & Efter) */}\n                                    {isExpanded && (\n                                        <div className=\"mt-5 pt-5 border-t border-slate-50 animate-in fade-in zoom-in-95 duration-200\">\n                                            <div className=\"grid grid-cols-2 gap-4\">\n                                                <div className=\"space-y-2\">\n                                                    <span className=\"text-[10px] font-bold text-slate-400 uppercase tracking-tight block\">Före</span>\n                                                    {['x','y','z'].map(axis => (\n                                                        <div key={axis} className=\"flex justify-between items-center text-xs bg-slate-50 px-3 py-1.5 rounded-lg\">\n                                                            <span className=\"text-slate-300 uppercase font-bold text-[9px]\">{axis}</span>\n                                                            <span className=\"font-mono text-slate-600\">{log.before[axis] || '0.00'}</span>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                                <div className=\"space-y-2\">\n                                                    <span className=\"text-[10px] font-bold text-blue-400 uppercase tracking-tight block text-right\">Efter</span>\n                                                    {['x','y','z'].map(axis => (\n                                                        <div key={axis} className=\"flex justify-between items-center text-xs bg-blue-50/50 px-3 py-1.5 rounded-lg border border-blue-50\">\n                                                            <span className=\"text-blue-200 uppercase font-bold text-[9px]\">{axis}</span>\n                                                            <span className=\"font-mono text-blue-700 font-medium\">{log.after[axis] || '0.00'}</span>\n                                                        </div>\n                                                    ))}\n                                                </div>\n                                            </div>\n                                            \n                                            {log.note && (\n                                                <div className=\"mt-4 p-3 bg-amber-50/50 rounded-2xl border border-amber-100/20\">\n                                                    <p className=\"text-[11px] text-amber-800 leading-relaxed italic\">\"{log.note}\"</p>\n                                                </div>\n                                            )}\n                                        </div>\n                                    )}\n                                </div>\n                            );\n                        })}\n                    </div>\n                </div>\n            );\n        }\n\n        const root = ReactDOM.createRoot(document.getElementById(\"root\"));\n        root.render(<App />);\n    <\/script>\n</body>\n</html>\n"},{"name":"cm4d tool","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>V436 Advanced Inspection Tool</title>\n\n<!-- Libraries -->\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js\"><\/script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"><\/script>\n\n<style>\n:root {\n    --brand:#0f172a; --accent:#3b82f6;\n    --success:#16a34a; --danger:#dc2626; --bg:#f8fafc;\n}\nbody {\n    font-family: Inter, sans-serif;\n    background:var(--bg); margin:0; padding:20px; color:#334155;\n}\n.container {\n    max-width:1400px; margin:auto; background:white;\n    padding:30px; border-radius:12px;\n    box-shadow:0 10px 15px -3px rgba(0,0,0,.1);\n}\nheader {\n    display:flex; justify-content:space-between; align-items:center;\n    border-bottom:2px solid #e2e8f0; padding-bottom:20px; margin-bottom:20px;\n}\n.upload-zone {\n    background:#f1f5f9; border:2px dashed #cbd5e1;\n    padding:25px; text-align:center; border-radius:8px;\n    margin-bottom:20px; cursor:pointer;\n}\n.upload-zone:hover { border-color:var(--accent); background:#eff6ff; }\n.toolbar { display:flex; gap:10px; margin-bottom:20px; }\n.search-input {\n    flex-grow:1; padding:12px; border:1px solid #cbd5e1;\n    border-radius:6px; font-size:14px;\n}\n.btn {\n    padding:10px 20px; border:none; border-radius:6px;\n    cursor:pointer; font-weight:bold; color:white;\n}\n.btn-excel{background:var(--success)}\n.btn-pdf{background:#64748b}\n\ntable { width:100%; border-collapse:collapse; font-size:13px; }\nth {\n    background:var(--brand); color:white; padding:12px;\n    position:sticky; top:0; text-align:left;\n}\ntd { padding:8px 12px; border-bottom:1px solid #e2e8f0; }\ntr:hover { background:#f8fafc; }\n\n.input-measure {\n    width:95px; padding:6px;\n    border:1px solid #cbd5e1;\n    border-radius:4px;\n    text-align:center;\n    font-weight:bold;\n}\n.input-measure::placeholder {\n    color:#94a3b8;\n    font-weight:normal;\n}\n\n.status-pill {\n    padding:4px 10px; border-radius:12px;\n    font-size:11px; font-weight:bold;\n    display:inline-block; min-width:60px; text-align:center;\n}\n.OK{background:#dcfce7;color:#166534}\n.NOK{background:#fee2e2;color:#991b1b}\n.pending{background:#f1f5f9;color:#64748b}\n</style>\n</head>\n\n<div class=\"container\">\n\n<header>\n<div>\n    <h1 style=\"margin:0\">Asebraoui CM4D Tool</h1>\n    <p id=\"subtitle\" style=\"margin:5px 0;color:#64748b\">\n        Geometry Analyse Support\n    </p>\n    <p id=\"routineInfo\" style=\"margin:2px 0;color:#475569;font-weight:bold\"></p>\n</div>\n<div style=\"text-align:right\">\n    <div id=\"stats\" style=\"font-weight:bold\">0 / 0 Completed</div>\n    <small id=\"curDate\"></small>\n</div>\n</header>\n\n<div>\n<div class=\"upload-zone\" onclick=\"fileInput.click()\">\n    <strong>Click to select file</strong> or drag here\n    <input id=\"fileInput\" type=\"file\" accept=\".csv\" hidden>\n</div>\n\n<div class=\"toolbar\">\n    <input id=\"search\" class=\"search-input\"\n           placeholder=\"Search Feature, Tool, Side, Type...\"\n           onkeyup=\"doSearch()\">\n    <button class=\"btn btn-excel\" onclick=\"saveExcel()\">Excel</button>\n    <button class=\"btn btn-pdf\" onclick=\"window.print()\">PDF</button>\n</div>\n</div>\n\n<table id=\"mainTable\">\n<thead>\n<tr>\n    <th>Feature ID</th>\n    <th>TOOL NO.</th>\n    <th>Side</th>\n    <th>Type</th>\n    <th>Nominal</th>\n    <th>TOL</th>\n    <th>Measured</th>\n    <th>Result</th>\n</tr>\n</thead>\n<tbody id=\"tableBody\"></tbody>\n</table>\n\n</div>\n\n<script>\ncurDate.innerText = new Date().toLocaleString();\n\nfileInput.addEventListener(\"change\", e => {\n    Papa.parse(e.target.files[0], {\n        skipEmptyLines:true,\n        complete: res => buildTable(res.data, e.target.files[0].name)\n    });\n});\n\nfunction normalize(v){\n    return String(v || \"\").trim().toLowerCase();\n}\n\nfunction handleEnter(e, input) {\n    if (e.key === \"Enter\") {\n        e.preventDefault();\n        const inputs = [...document.querySelectorAll(\".input-measure\")];\n        const idx = inputs.indexOf(input);\n        if (idx > -1 && idx < inputs.length - 1) {\n            inputs[idx + 1].focus();\n            inputs[idx + 1].select();\n        }\n    }\n}\n\nfunction buildTable(rows, name){\n    tableBody.innerHTML = \"\";\n\n    const hIdx = rows.findIndex(r =>\n        r.some(c => normalize(c) === \"feature\")\n    );\n    if (hIdx < 0) return alert(\"Header row not found\");\n\n    const h = rows[hIdx];\n    const idx = n => h.findIndex(c => normalize(c) === normalize(n));\n\n    const c = {\n        id: idx(\"Feature\"),\n        tool: idx(\"GAUGE TYPE\"),\n        hand: idx(\"SMI Hand\"),\n        type: idx(\"SMI Type\"),\n        routine:idx(\"Routine\"),\n        gNom: idx(\"Gap\"),\n        gUp: idx(\"Upper Gap\"),\n        fNom: idx(\"Flush\"),\n        fUp: idx(\"Upper Flush\"),\n        stdNom: idx(\"NOM\"),\n        stdTol: idx(\"TOL\")\n    };\n  /* === FIND ROUTINE TEXT ANYWHERE IN CSV === */\nlet routineValue = \"-\";\n\nrows.some(row => {\n    return row.some(cell => {\n        if (typeof cell === \"string\" && cell.includes(\"Routine:\")) {\n            const match = cell.match(/Routine:\\s*(.*?)\\s*No Subroutine/i);\n            if (match && match[1]) {\n                routineValue = match[1].trim();\n                return true;\n            }\n        }\n        return false;\n    });\n});\n\nroutineInfo.innerText = `Routine: ${routineValue}`;\n\n\n    let count = 0;\n\n    rows.slice(hIdx + 1).forEach(r => {\n        const id = String(r[c.id] || \"\").trim();\n        if (!id || id.toUpperCase().includes(\"VAR\")) return;\n\n        let nom = 0, tol = 0, type = r[c.type] || \"-\";\n\n        if (r[c.gNom] && r[c.gUp]) {\n            nom = +r[c.gNom];\n            tol = Math.abs(+r[c.gUp]);\n            type = \"Gap\";\n        } else if (r[c.fNom] && r[c.fUp]) {\n            nom = +r[c.fNom];\n            tol = Math.abs(+r[c.fUp]);\n            type = \"Flush\";\n        } else if (c.stdNom >= 0) {\n            nom = +r[c.stdNom];\n            tol = Math.abs(String(r[c.stdTol] || \"0\").replace(\"±\",\"\"));\n        }\n\n        const lsl = nom - tol;\n        const usl = nom + tol;\n\n        tableBody.insertAdjacentHTML(\"beforeend\", `\n        <tr>\n            <td><b>${id}</b></td>\n            <td>${r[c.tool] || \"-\"}</td>\n            <td>${r[c.hand] || \"-\"}</td>\n            <td style=\"color:#64748b\">${type}</td>\n            <td>${nom.toFixed(2)}</td>\n            <td><b>±${tol.toFixed(2)}</b></td>\n            <td>\n                <input class=\"input-measure\"\n                       type=\"number\"\n                       step=\"0.01\"\n                       min=\"${lsl.toFixed(2)}\"\n                       max=\"${usl.toFixed(2)}\"\n                       placeholder=\"${lsl.toFixed(2)} – ${usl.toFixed(2)}\"\n                       title=\"Allowed range: ${lsl.toFixed(2)} to ${usl.toFixed(2)}\"\n                       oninput=\"validate(this,${lsl},${usl})\"\n                       onkeydown=\"handleEnter(event, this)\">\n            </td>\n            <td><span class=\"status-pill pending\">Pending</span></td>\n        </tr>`);\n        count++;\n    });\n\n    fileInfo.innerText = `File: ${name} (${count} Points)`;\n    updateStats();\n}\n\nfunction validate(inp, lsl, usl){\n    const v = +inp.value;\n    const pill = inp.closest(\"tr\").querySelector(\".status-pill\");\n\n    if (!inp.value) {\n        pill.className = \"status-pill pending\";\n        pill.innerText = \"Pending\";\n    } else if (v >= lsl && v <= usl) {\n        pill.className = \"status-pill OK\";\n        pill.innerText = \"OK\";\n    } else {\n        pill.className = \"status-pill NOK\";\n        pill.innerText = \"NOK\";\n    }\n    updateStats();\n}\n\nfunction updateStats(){\n    const inputs = [...document.querySelectorAll(\".input-measure\")];\n    stats.innerText = `${inputs.filter(i => i.value).length} / ${inputs.length} Completed`;\n}\n\nfunction saveExcel(){\n    const wb = XLSX.utils.book_new();\n    const ws = XLSX.utils.table_to_sheet(mainTable);\n    XLSX.utils.book_append_sheet(wb, ws, \"Inspection\");\n    XLSX.writeFile(\n        wb,\n        `V436_Inspection_${new Date().toISOString().replace(/[:.]/g,\"-\")}.xlsx`\n    );\n}\n\nfunction doSearch() {\n  // Read and normalize the search box\n  const raw = search.value.toLowerCase().trim();\n\n  // Split by any whitespace; ignore empty chunks\n  const terms = raw.split(/\\s+/).filter(Boolean);\n\n  // If nothing typed -> show everything\n  if (terms.length === 0) {\n    [...tableBody.rows].forEach(r => r.style.display = \"\");\n    return;\n  }\n\n  // Show a row if ANY term matches (OR logic)\n  [...tableBody.rows].forEach(row => {\n    const text = row.innerText.toLowerCase();\n    const matchesAny = terms.some(t => text.includes(t));\n    row.style.display = matchesAny ? \"\" : \"none\";\n  });\n}\n<\/script>\n\n</body>\n</html>\n"},{"name":"uploader","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>V436 Ultimate Inspection Tool</title>\n\n<!-- XLSX for Excel export -->\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js\"><\/script>\n\n<style>\n    :root {\n        --brand: #0f172a;\n        --accent: #3b82f6;\n        --success: #16a34a;\n    }\n    body {\n        font-family: Arial, sans-serif;\n        background: #f8fafc;\n        padding: 20px;\n    }\n    .container {\n        background: white;\n        padding: 30px;\n        border-radius: 12px;\n        box-shadow: 0 8px 30px rgba(0,0,0,0.12);\n        max-width: 1400px;\n        margin: auto;\n    }\n    header {\n        display: flex; justify-content: space-between; align-items: center;\n        padding-bottom: 15px; margin-bottom: 20px;\n        border-bottom: 2px solid #e2e8f0;\n    }\n    .btn {\n        padding: 10px 20px; border-radius: 6px;\n        border: none; color: white; cursor: pointer;\n        font-weight: 600;\n    }\n    .btn-add { background: var(--accent); }\n    .btn-excel { background: var(--success); }\n    .btn-pdf { background: #555; }\n\n    table {\n        width: 100%; border-collapse: collapse;\n        margin-top: 15px; font-size: 13px;\n    }\n    th {\n        background: var(--brand); color: white;\n        padding: 10px; position: sticky; top: 0;\n    }\n    td {\n        padding: 8px; border-bottom: 1px solid #e2e8f0;\n    }\n    tr:hover { background: #f1f5f9; }\n\n    .input-measure {\n        width: 90px; padding: 6px;\n        border-radius: 6px; border: 1px solid #cbd5e1;\n        text-align: center;\n    }\n\n    .status-pill {\n        padding: 4px 12px; border-radius: 10px; font-weight: bold;\n    }\n    .pass { background: #dcfce7; color: #166534; }\n    .fail { background: #fee2e2; color: #991b1b; }\n    .pending { background: #f1f5f9; color: #64748b; }\n\n    .manual-box {\n        background: #f1f5f9; padding: 15px;\n        border-radius: 10px; margin-bottom: 20px;\n    }\n    .manual-box input {\n        padding: 7px; margin-right: 10px;\n        margin-bottom: 6px;\n        border-radius: 6px;\n        border: 1px solid #cbd5e1;\n    }\n\n    .icon-btn {\n        background: white;\n        border: 1px solid #cbd5e1;\n        padding: 2px 6px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 12px;\n    }\n    .icon-btn:hover {\n        background: #e2e8f0;\n    }\n\n    .car-id-input {\n        padding: 5px;\n        border: 1px solid #cbd5e1;\n        border-radius: 5px;\n        width: 80px;\n    }\n\n    @media print {\n        .no-print { display: none; }\n        body { padding: 0; }\n        .container { box-shadow: none; }\n    }\n</style>\n\n</head>\n<body>\n\n<div class=\"container\">\n\n<header>\n    <div>\n        <h1 style=\"margin:0\">Asebraoui CM4D Tool</h1>\n        <p id=\"subtitle\" style=\"margin:5px 0;color:#64748b\">Geometry Analyse Support</p>\n    </div>\n\n    <div class=\"no-print\">\n        <label><strong>CAR ID:</strong></label>\n        <input id=\"carID\" type=\"text\" placeholder=\"Optional\" style=\"padding:6px;\">\n    </div>\n</header>\n\n<!-- Manual Add Section -->\n<div class=\"manual-box no-print\">\n    <h3>Add Custom Measurement</h3>\n\n    <input id=\"m_id\" placeholder=\"Feature ID\">\n    <input id=\"m_side\" placeholder=\"Side (LH/RH)\">\n    <input id=\"m_type\" placeholder=\"Type\">\n    <input id=\"m_nom\" placeholder=\"Nominal\" type=\"number\" step=\"0.01\">\n    <input id=\"m_tol\" placeholder=\"Tolerance\" type=\"number\" step=\"0.01\">\n    <input id=\"m_lsl\" placeholder=\"LSL (optional)\" type=\"number\" step=\"0.01\">\n    <input id=\"m_usl\" placeholder=\"USL (optional)\" type=\"number\" step=\"0.01\">\n\n    <button class=\"btn btn-add\" onclick=\"addManualRow()\">Add</button>\n</div>\n\n<div class=\"toolbar no-print\" style=\"display:flex; gap:10px; margin-bottom:15px;\">\n    <input id=\"search\" class=\"search-input\" placeholder=\"Search...\" \n           onkeyup=\"doSearch()\" \n           style=\"flex:1; padding:10px; border-radius:6px; border:1px solid #cbd5e1;\">\n    <button class=\"btn btn-excel\" onclick=\"saveExcel()\">Excel</button>\n    <button class=\"btn btn-pdf\" onclick=\"window.print()\">PDF</button>\n</div>\n\n<table id=\"mainTable\">\n<thead>\n    <tr>\n        <th>CAR ID</th>\n        <th>Feature ID</th>\n        <th>Side</th>\n        <th>Type</th>\n        <th>Nominal</th>\n        <th>TOL (±)</th>\n        <th>LSL</th>\n        <th>USL</th>\n        <th>Measured</th>\n        <th>Result</th>\n        <th class=\"no-print\">Actions</th>\n    </tr>\n</thead>\n\n<tbody id=\"tableBody\"></tbody>\n</table>\n\n</div>\n\n<script>\n\n// ENTER KEY HANDLING\ndocument.addEventListener(\"keydown\", e => {\n\n    if (document.activeElement.classList.contains(\"car-id-input\")) return;\n\n    if (e.key === \"Enter\" && document.activeElement.classList.contains(\"input-measure\")) {\n        e.preventDefault();\n\n        let inp = document.activeElement;\n        let savedValue = inp.value;\n        inp.setAttribute(\"value\", savedValue);\n\n        let row = inp.closest(\"tr\");\n        let next = row.nextElementSibling;\n\n        if (!next) {\n            let tbody = document.getElementById(\"tableBody\");\n            let newRow = row.cloneNode(true);\n\n            newRow.querySelector(\".input-measure\").value = \"\";\n            newRow.querySelector(\".status-pill\").className = \"status-pill pending\";\n            newRow.querySelector(\".status-pill\").innerText = \"Pending\";\n\n            tbody.appendChild(newRow);\n            next = newRow;\n        }\n\n        let nextInput = next.querySelector(\".input-measure\");\n        if (nextInput) nextInput.focus();\n    }\n});\n\n// ADD CUSTOM ROW\nfunction addManualRow() {\n\n    let car = carID.value || \"-\";\n    let id = m_id.value || \"-\";\n    let side = m_side.value || \"-\";\n    let type = m_type.value || \"Custom\";\n\n    let nom = parseFloat(m_nom.value) || 0;\n    let tol = parseFloat(m_tol.value);\n\n    let lsl = parseFloat(m_lsl.value);\n    let usl = parseFloat(m_usl.value);\n\n    if (isNaN(lsl) || isNaN(usl)) {\n        if (!isNaN(tol)) {\n            lsl = nom - tol;\n            usl = nom + tol;\n        } else {\n            lsl = nom;\n            usl = nom;\n        }\n    }\n\n    let tolText = isNaN(tol) ? \"±0.00\" : `±${tol.toFixed(2)}`;\n\n    const tbody = document.getElementById(\"tableBody\");\n    const tr = document.createElement(\"tr\");\n\n    tr.innerHTML = `\n        <td>\n            <span class=\"car-id-text\"><strong>${car}</strong></span>\n            <button class=\"icon-btn\" onclick=\"editCarId(this)\">✎</button>\n        </td>\n        <td><strong>${id}</strong></td>\n        <td>${side}</td>\n        <td>${type}</td>\n        <td>${nom.toFixed(2)}</td>\n        <td style=\"color:purple;\">${tolText}</td>\n        <td style=\"color:blue;\">${lsl.toFixed(2)}</td>\n        <td style=\"color:red;\">${usl.toFixed(2)}</td>\n        <td>\n            <input type=\"number\" class=\"input-measure\" step=\"0.01\"\n                oninput=\"validate(this, ${lsl}, ${usl})\">\n        </td>\n        <td><span class=\"status-pill pending\">Pending</span></td>\n        <td class=\"no-print\">\n            <button class=\"icon-btn\" onclick=\"duplicateRow(this)\">⎘</button>\n        </td>\n    `;\n\n    tbody.appendChild(tr);\n\n    m_id.value = \"\";\n    m_side.value = \"\";\n    m_type.value = \"\";\n    m_nom.value = \"\";\n    m_tol.value = \"\";\n    m_lsl.value = \"\";\n    m_usl.value = \"\";\n}\n\n// EDIT CAR ID\nfunction editCarId(btn) {\n    const td = btn.closest(\"td\");\n    const span = td.querySelector(\".car-id-text\");\n\n    let input = td.querySelector(\".car-id-input\");\n    if (!input) {\n        input = document.createElement(\"input\");\n        input.className = \"car-id-input\";\n        td.insertBefore(input, btn);\n\n        input.addEventListener(\"keydown\", e => {\n            if (e.key === \"Enter\") saveCarId(input, span);\n            e.stopPropagation();\n        });\n        input.addEventListener(\"blur\", () => saveCarId(input, span));\n    }\n\n    input.value = span.textContent.trim();\n    span.style.display = \"none\";\n    input.style.display = \"inline-block\";\n    input.focus();\n    input.select();\n}\n\nfunction saveCarId(input, span) {\n    let newVal = input.value.trim() || \"-\";\n    span.textContent = newVal;\n    span.style.display = \"inline\";\n    input.style.display = \"none\";\n}\n\n// DUPLICATE ROW\nfunction duplicateRow(btn) {\n    const row = btn.closest(\"tr\");\n    const clone = row.cloneNode(true);\n\n    clone.querySelector(\".input-measure\").value = \"\";\n    const pill = clone.querySelector(\".status-pill\");\n    pill.className = \"status-pill pending\";\n    pill.textContent = \"Pending\";\n\n    row.parentNode.insertBefore(clone, row.nextSibling);\n}\n\n// VALIDATION\nfunction validate(inp, low, high) {\n    const v = parseFloat(inp.value);\n    const pill = inp.closest(\"tr\").querySelector(\".status-pill\");\n\n    if (!inp.value) {\n        pill.className = \"status-pill pending\";\n        pill.innerText = \"Pending\";\n    } else if (v >= low && v <= high) {\n        pill.className = \"status-pill pass\";\n        pill.innerText = \"Pass\";\n    } else {\n        pill.className = \"status-pill fail\";\n        pill.innerText = \"Fail\";\n    }\n}\n\n// SEARCH\nfunction doSearch() {\n    let q = search.value.toLowerCase();\n    document.querySelectorAll(\"#tableBody tr\").forEach(r => {\n        r.style.display = r.innerText.toLowerCase().includes(q) ? \"\" : \"none\";\n    });\n}\n\n// EXCEL EXPORT\nfunction saveExcel() {\n    const wb = XLSX.utils.table_to_book(document.getElementById(\"mainTable\"));\n    XLSX.writeFile(wb, `V436_${new Date().toISOString().slice(0,10)}.xlsx`);\n}\n\n<\/script>\n\n</body>\n</html>"}];
const PWD = 'geo';

function login() {
    if(document.getElementById('ps').value.toLowerCase() === PWD) {
        document.getElementById('ls').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
        renderGrid();
    } else { alert('ACCESS DENIED'); }
}

function renderGrid() {
    const g = document.getElementById('grid');
    g.innerHTML = '';
    DATA.forEach((m, i) => {
        const c = document.createElement('div');
        c.className = 'card';
        c.innerHTML = '<h2>' + m.name + '</h2><p style="color:#0f0; font-size:10px; margin-top:10px;">INITIALIZE MODULE</p>';
        c.onclick = () => openMod(i);
        g.appendChild(c);
    });
}

function openMod(i) {
    document.getElementById('app').style.display = 'none';
    document.getElementById('view').style.display = 'flex';
    const wrap = document.getElementById('frame-wrap');
    wrap.innerHTML = '';
    const f = document.createElement('iframe');
    wrap.appendChild(f);
    const d = f.contentDocument || f.contentWindow.document;
    d.open(); d.write(DATA[i].content); d.close();
}

function back() {
    document.getElementById('app').style.display = 'flex';
    document.getElementById('view').style.display = 'none';
}
</script>
</body>
</html>
